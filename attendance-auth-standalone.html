<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Student Attendance â€” Google/Apple Login + Email Notify</title>
  <style>
*{box-sizing:border-box}html,body{margin:0;padding:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,"Noto Sans",sans-serif}:root{--bg:#0f172a;--card:#111827;--text:#e5e7eb;--muted:#9ca3af;--accent:#3b82f6;--success:#22c55e;--danger:#ef4444;--border:#1f2937}body{background:var(--bg);color:var(--text)}.app-header,.app-footer{padding:1rem 2rem;border-bottom:1px solid var(--border)}.app-footer{border-top:1px solid var(--border);border-bottom:none}.card{background:var(--card);margin:1rem auto;max-width:900px;border:1px solid var(--border);border-radius:12px;padding:1rem}.card-header{display:flex;align-items:center;justify-content:space-between;gap:1rem;flex-wrap:wrap}.auth-buttons{display:flex;gap:.75rem;align-items:center;flex-wrap:wrap}.btn{padding:.6rem .9rem;border:1px solid var(--border);background:#0b1220;color:var(--text);border-radius:8px;cursor:pointer}.btn:hover{border-color:var(--accent)}.btn-google{background:#4285F4;border-color:#4285F4;color:#fff}.btn-apple{background:#000;border-color:#000;color:#fff}.btn-danger{background:var(--danger);border-color:var(--danger);color:#fff}.hidden{display:none}.muted{color:var(--muted)}.actions{display:flex;gap:.5rem;align-items:center;flex-wrap:wrap}
</style>
  <!-- Firebase SDKs (modular) -->
  <script type="module">
    // Tip: replace version numbers with latest if needed
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
    import { getAuth, signInWithPopup, GoogleAuthProvider, OAuthProvider, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';
    import { getFirestore, collection, addDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';

    // TODO: Paste your Firebase config here (from Firebase Console > Project Settings > Web App)
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const UI = {
      authView: document.getElementById('auth'),
      appView: document.getElementById('app'),
      googleBtn: document.getElementById('googleSignIn'),
      appleBtn: document.getElementById('appleSignIn'),
      logoutBtn: document.getElementById('logoutBtn'),
      status: document.getElementById('status'),
      ownerEmail: 'akshar7285@gmail.com'
    };

    async function notifyOwner(user) {
      try {
        // Requires Firebase Extension: Trigger Email (firestore-send-email) with SMTP configured
        await addDoc(collection(db, 'mail'), {
          to: UI.ownerEmail,
          message: {
            subject: 'New login to Attendance App',
            html: `<p>User logged in:</p>
                   <ul>
                     <li>UID: ${user.uid}</li>
                     <li>Name: ${user.displayName || ''}</li>
                     <li>Email: ${user.email || ''}</li>
                     <li>Provider: ${(user.providerData && user.providerData[0] && user.providerData[0].providerId) || 'unknown'}</li>
                   </ul>
                   <p>Time: ${new Date().toLocaleString('en-IN')}</p>`
          },
          createdAt: serverTimestamp()
        });
        UI.status.textContent = 'Login email notification queued.';
      } catch (e) {
        UI.status.textContent = 'Failed to queue email: ' + e.message;
      }
    }

    async function doGoogleLogin() {
      const provider = new GoogleAuthProvider();
      try {
        const result = await signInWithPopup(auth, provider);
        await notifyOwner(result.user);
      } catch (e) {
        UI.status.textContent = 'Google login error: ' + e.message;
      }
    }

    async function doAppleLogin() {
      // Apple via Firebase: requires Apple provider configuration in Firebase Console and Apple Developer setup
      const provider = new OAuthProvider('apple.com');
      provider.addScope('email');
      provider.addScope('name');
      try {
        const result = await signInWithPopup(auth, provider);
        await notifyOwner(result.user);
      } catch (e) {
        UI.status.textContent = 'Apple login error: ' + e.message;
      }
    }

    onAuthStateChanged(auth, (user) => {
      if (user) {
        UI.authView.classList.add('hidden');
        UI.appView.classList.remove('hidden');
        UI.status.textContent = `Signed in as ${user.displayName || user.email || user.uid}`;
      } else {
        UI.appView.classList.add('hidden');
        UI.authView.classList.remove('hidden');
        UI.status.textContent = '';
      }
    });

    UI.googleBtn.addEventListener('click', doGoogleLogin);
    UI.appleBtn.addEventListener('click', doAppleLogin);
    UI.logoutBtn.addEventListener('click', () => signOut(auth));
  </script>
</head>
<body>
  <header class="app-header">
    <h1>Student Attendance</h1>
    <p class="muted">Sign in with Google or Apple; auto email to admin on login</p>
  </header>

  <!-- Auth screen -->
  <section id="auth" class="card">
    <h2>Sign in</h2>
    <p class="muted">Choose a sign-in method below.</p>
    <div class="auth-buttons">
      <button id="googleSignIn" class="btn btn-google">Sign in with Google</button>
      <button id="appleSignIn" class="btn btn-apple">Sign in with Apple</button>
    </div>
    <p id="status" class="muted"></p>
  </section>

  <!-- App (scanner removed) -->
  <main id="app" class="hidden">
    <section class="card">
      <div class="card-header">
        <h2>Welcome</h2>
        <div class="actions">
          <button id="logoutBtn" class="btn btn-danger">Logout</button>
        </div>
      </div>
      <p class="muted">Attendance features stay as before. Face scanner is removed.</p>
    </section>
  </main>

  <footer class="app-footer"><p class="muted">Powered by Firebase Authentication + Firestore Trigger Email.</p></footer>
</body>
</html>